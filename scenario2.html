<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Scenario 2</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/textmate.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="css\styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}

.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
  padding-left: 10px;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">WRV Training</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Overview</a>
</li>
<li>
  <a href="calib-model.html">Calibrated Model</a>
</li>
<li>
  <a href="scenario2.html">Scenario 2</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Scenario 2</h1>

</div>


<p>These instructions describe how to build, run, and analyze an example model scenario (Scenario 2). The model scenario describes the effects of allowing an existing parcel of irrigated land to be reclassified as “non-irrigated”; that is, what happens when you voluntarily allow an irrigated parcel to go idle. Model boundary conditions are modified in the archived calibrated model to best represent this scenario. The idled land parcel (about 600 acres, or better yet 2.4-square kilometers) is shown in the following figure.</p>
<p><img src="images/scenario2-desc_01.png" /></p>
<p>Changes to <a href="https://github.com/USGS-R/wrv/tree/master/inst/extdata">unprocessed-data files</a> include:</p>
<ul>
<li><p>Irrigated lands (“extdata/irr/irr.lands.&lt;YYYY&gt;.zip”)—changed parcel status to “non-irrigated”.</p></li>
<li><p>Evapotranspiration (ET)(“extdata/et/et.&lt;YYYMM&gt;.tif”)—reduced ET within the parcel and set equal to the monthly precipitation during the irrigation season (April–October).</p></li>
<li><p>Combined surface-water irrigation diversions (“extdata/div/comb.sw.irr.csv”)–removed diversions associated with wells in parcel.</p></li>
<li><p>Groundwater points of diversion (“extdata/div/pod.gw.csv”)—removed diversions for wells in parcel.</p></li>
<li><p>Well sites (“extdata/div/pod.wells.zip”)—removed sites located in parcel.</p></li>
</ul>
<p>Files that did not need to be modified for this scenario, but may want to considered for modification in similar types of model scenarios include:</p>
<ul>
<li><p>Surface water diversions (“div.sw.csv”)—we assumed surface water associated with the idled parcel is now delivered to other “junior” users within the same canal service area.</p></li>
<li><p>Groundwater diversions (“div.gw.csv”)—if there had been “measured” groundwater diversions associated with the parcel, those would need to be removed.</p></li>
</ul>
<p>Startup an R session. Set the working directory to the local wrv-training repository, that is the “wrv-training” folder, by typing the following command in your R console and making sure to change the file path to the correct location:</p>
<pre class="r"><code>setwd(&quot;I:/Software/wrv-training&quot;)</code></pre>
<p>Load the <strong>wrv</strong>, <a href="https://CRAN.R-project.org/package=inlmisc"><strong>inlmisc</strong></a>, <a href="https://CRAN.R-project.org/package=raster"><strong>raster</strong></a>, and <a href="https://CRAN.R-project.org/package=rgdal"><strong>rgdal</strong></a> packages into your current R environment, using</p>
<pre class="r"><code>lapply(c(&quot;wrv&quot;, &quot;inlmisc&quot;, &quot;raster&quot;, &quot;rgdal&quot;), library, character.only = TRUE)</code></pre>
<div id="code-chunks" class="section level2">
<h2>Code Chunks</h2>
<p>Most of the R code that we need for building, running, and analyzing Scenario 2 is contained within the appendix files. Rather than rewrite all the relevant code here, we will instead write a simple function to read code chunks within an appendix code file.</p>
<pre class="r"><code>ReadCodeChunks &lt;- function(file) {
  src &lt;- readLines(file)
  src &lt;- src[src != &quot;&quot;]
  lin &lt;- grep(&quot;## ----&quot;, src)
  nam &lt;- gsub(&quot;#|-| |\\,.*&quot;, &quot;&quot;, src[lin])
  is.unnamed &lt;- which(grepl(&quot;=&quot;, nam) | nam == &quot;&quot;)
  nam[is.unnamed] &lt;- paste0(&quot;unnamed-chunk-&quot;, is.unnamed)
  m &lt;- cbind(from = lin, to = c(lin[-1] - 1, length(src)))
  chunks &lt;- apply(m, 1, function(x) src[x[1]:x[2]])
  names(chunks) &lt;- nam
  return(chunks)
}</code></pre>
<p>Let’s put our new function to use by reading in code chunks from appendix C and D.</p>
<pre class="r"><code>file &lt;- system.file(&quot;doc&quot;, &quot;sir20165080_AppendixC.R&quot;, package = &quot;wrv&quot;)
app.c.chunks &lt;- ReadCodeChunks(file)
file &lt;- system.file(&quot;doc&quot;, &quot;sir20165080_AppendixD.R&quot;, package = &quot;wrv&quot;)
app.d.chunks &lt;- ReadCodeChunks(file)</code></pre>
<p>Each of the relevant code chunks is labeled with a unique name. For example, the following command retrieves the code chunk named “write_modflow_input” in appendix D:</p>
<pre class="r"><code>chunk &lt;- app.d.chunks[[&quot;write_modflow_input&quot;]]
print(chunk)</code></pre>
<pre><code>[1] &quot;## ----write_modflow_input-------------------------------------------------&quot;     
[2] &quot;id &lt;- \&quot;wrv_mfusg\&quot;  # model run identifier&quot;                                     
[3] &quot;dir.run &lt;- \&quot;model/model1\&quot;&quot;                                                     
[4] &quot;WriteModflowInput(rs.model, rech, well, trib, misc, river, drain, id, dir.run,&quot;  
[5] &quot;                  is.convertible = FALSE, tr.stress.periods = tr.stress.periods,&quot;
[6] &quot;                  ntime.steps = ntime.steps, verbose = FALSE)&quot;                   </code></pre>
</div>
<div id="create-modified-datasets" class="section level2">
<h2>Create Modified Datasets</h2>
<p>Every time we create a modified dataset it masks its <strong>wrv</strong>-package version. The R script for creating the modified datasets is primarily based on code chunks in Appendix C. Run (parse and evaluate) the code chunk named “setup” in Appendix C using the following command:</p>
<pre class="r"><code>eval(parse(text = app.c.chunks[[&quot;setup&quot;]]))</code></pre>
<p>Specify the folder in your working directory that contains the modified unprocessed-data files (“extdata”) and place them in a temporary directory as uncompressed files using</p>
<pre class="r"><code>folder &lt;- &quot;extdata&quot;
files &lt;- list.files(folder, full.names = TRUE, recursive = TRUE)
dirs &lt;- file.path(tempdir(), unique(dirname(files)))
sapply(dirs, function(i) dir.create(i, recursive = TRUE))
file.copy(files, file.path(tempdir(), files))
dir.in &lt;- file.path(tempdir(), &quot;extdata&quot;)
files &lt;- list.files(dir.in, pattern = &quot;*.zip$&quot;, full.names = TRUE, recursive = TRUE)
for (i in files) unzip(i, exdir = dirname(i))</code></pre>
<p>Create a folder in your working directory where modified R-data files will be written.</p>
<pre class="r"><code>dir.out &lt;- &quot;data&quot;
dir.create(dir.out, showWarnings = FALSE)</code></pre>
<p>Run the initial commands for specifying the unit conversions, coordinate reference system (CRS), and common spatial/temporal grid.</p>
<pre class="r"><code>chunk.names &lt;- c(&quot;unit_conversions&quot;, &quot;crs&quot;, &quot;spatial&quot;, &quot;high_res_spatial&quot;, &quot;temporal&quot;)
eval(parse(text = unlist(app.c.chunks[chunk.names])))</code></pre>
<div id="level-1-data" class="section level3">
<h3>Level 1 data</h3>
<p>These are processing instructions for creating level 1 modified datasets.</p>
<div id="combined-surface-water-irrigation-diversions-comb.sw.irr" class="section level4">
<h4>Combined surface-water irrigation diversions (comb.sw.irr)</h4>
<p>Read combined surface-water irrigation diversions data and write its external representation as an R object in “data/comb.sw.irr.rda”.</p>
<pre class="r"><code>eval(parse(text = app.c.chunks[[&quot;comb_sw_irr_1&quot;]]))</code></pre>
</div>
<div id="points-of-diversion-for-groundwater-pod.gw" class="section level4">
<h4>Points of diversion for groundwater (pod.gw)</h4>
<p>Read points of diversion for groundwater data and write its external representation as an R object in “data/pod.gw.csv.rda”.</p>
<pre class="r"><code>eval(parse(text = app.c.chunks[[&quot;pod_gw_1&quot;]]))</code></pre>
</div>
<div id="well-completions-pod.wells" class="section level4">
<h4>Well completions (pod.wells)</h4>
<p>Read well completions data and write its external representation as an R object in “data/pod.wells.rda”.</p>
<pre class="r"><code>eval(parse(text = unlist(app.c.chunks[c(&quot;pod_wells_1&quot;, &quot;pod_wells_2&quot;)])))</code></pre>
</div>
<div id="irrigation-lands-irr.lands" class="section level4">
<h4>Irrigation lands (irr.lands)</h4>
<p>Read irrigated and semi-irrigated lands data and write its external representation as an R object in “data/irr.lands.rda”.</p>
<pre class="r"><code>eval(parse(text = app.c.chunks[[&quot;irr_lands_1&quot;]]))</code></pre>
</div>
<div id="evapotranspiration-et" class="section level4">
<h4>Evapotranspiration (et)</h4>
<p>Read evapotranspiration (ET) data and write its external representation as an R object in “data/et.rda”. Note that unprocessed ET raster files (“.tif”) are required for every month in the simulation, not just months with modified values.</p>
<pre class="r"><code>eval(parse(text = unlist(app.c.chunks[c(&quot;et_1&quot;, &quot;et_2&quot;)])))</code></pre>
</div>
</div>
<div id="level-2-data" class="section level3">
<h3>Level 2 data</h3>
<p>These are processing instructions for creating level 2 modified datasets. Recall that level 2 datasets are dependent on level 1 data.</p>
<div id="monthly-irrigation-entity-components-entity.components" class="section level4">
<h4>Monthly irrigation entity components (entity.components)</h4>
<p>Write an external representation of monthly irrigation entity components as an R object in “data/entitiy.components.rda”.</p>
<pre class="r"><code>eval(parse(text = unlist(app.c.chunks[paste0(&quot;entity_components_&quot;, 1:3)])))</code></pre>
</div>
<div id="rasterized-monthly-irrigation-entities-rs.entities" class="section level4">
<h4>Rasterized monthly irrigation entities (rs.entities)</h4>
<p>Write an external representation of monthly irrigation entities as an R object in “data/rs.entities.rda”</p>
<pre class="r"><code>eval(parse(text = app.c.chunks[[&quot;rs_entities_1&quot;]]))</code></pre>
</div>
<div id="rasterized-monthly-recharge-on-non-irrigated-lands-rs.rech.non.irr" class="section level4">
<h4>Rasterized monthly recharge on non-irrigated lands (rs.rech.non.irr)</h4>
<p>Write an external representation of monthly recharge on non-irrigated lands as an R object in “data/rs.rech.non.irr.rda”.</p>
<pre class="r"><code>eval(parse(text = app.c.chunks[[&quot;rs_rech_non_irr_1&quot;]]))</code></pre>
</div>
</div>
</div>
<div id="model-processing" class="section level2">
<h2>Model Processing</h2>
<p>Let’s start model processing with a clean R environment. Remove all objects created during the previous instructions and reload our modified datasets.</p>
<pre class="r"><code>rm(list = ls()[ls() != &quot;app.d.chunks&quot;])
files &lt;- list.files(&quot;data&quot;, pattern = &quot;*.rda$&quot;, full.names = TRUE)
lapply(files, load, envir = .GlobalEnv)</code></pre>
<div id="copy-calibrated-files" class="section level3">
<h3>Copy calibrated files</h3>
<p>Copy all the <a href="calib-model.html">calibrated model</a> files from the “archive” folder to a new folder named “model” in our working directory.</p>
<pre class="r"><code>dir.create(&quot;model&quot;, showWarnings = FALSE)
files &lt;- list.files(&quot;archive&quot;, full.names = TRUE)
file.copy(files, &quot;model&quot;, overwrite = TRUE)</code></pre>
<p>Specify the identifier for the model run.</p>
<pre class="r"><code>id &lt;- &quot;wrv_mfusg&quot;</code></pre>
<p>Load R objects from the “model/model.rda” file into your R environment, these objects include <code>d.in.mv.ave</code>, <code>misc</code>, <code>reduction</code>, <code>rs</code>, <code>ss.stress.periods</code>, <code>tr.stress.periods</code>, and <code>trib</code>. A description of each R object is given in the help documentation of the <code>UpdateWaterBudget</code> function in the <strong>wrv</strong> package.</p>
<pre class="r"><code>load(&quot;model/model.rda&quot;)</code></pre>
<p>The <code>rs</code> object in the appendix D code is named <code>rs.model</code>; use the following command to address this issue:</p>
<pre class="r"><code>rs.model &lt;- rs</code></pre>
</div>
<div id="run-water-balance-model" class="section level3">
<h3>Run water-balance model</h3>
<p>Rerun the water-balance model using our <a href="scenario2.html#create_datasets">modified datasets</a>—this results in a new MODFLOW Well file (“model/_mfusg.wel“) and quality assurance tables (”model/qa-*.csv“). Note that all modified datasets need to be passed as arguments in the <code>UpdateWaterBudget</code> function.</p>
<pre class="r"><code>UpdateWaterBudget(&quot;model&quot;, id, qa.tables = &quot;english&quot;, pod.wells = pod.wells,
                  comb.sw.irr = comb.sw.irr, et = et,  pod.gw = pod.gw,
                  entity.components = entity.components, rs.entities = rs.entities)</code></pre>
</div>
<div id="run-modflow" class="section level3">
<h3>Run MODFLOW</h3>
<p>Run <a href="http://water.usgs.gov/ogw/mfusg/">MODFLOW-USG</a> using Scenario 2 conditions.</p>
<pre class="r"><code>wd &lt;- setwd(&quot;model&quot;)
system2(file.path(getwd(), &quot;RunModflow.bat&quot;), stdout = FALSE, stderr = FALSE)
setwd(wd)</code></pre>
</div>
<div id="read-water-budgets" class="section level3">
<h3>Read water budgets</h3>
<p>Read water-budget output for the archived calibrated simulation, located in the “archive” folder, and save the results for later use. To do so, run the code chunks named “read_budget_1” and “read_budget_2” in Appendix D using the following commands:</p>
<pre class="r"><code>dir.run &lt;- &quot;archive&quot;
eval(parse(text = unlist(app.d.chunks[paste0(&quot;read_budget_&quot;, 1:2)])))</code></pre>
<p>And save the average volumetric flow rates to an R object named “budget1” using</p>
<pre class="r"><code>budget1 &lt;- c(&quot;Water-table recharge&quot;             = mean(d.rech$flow.in),
             &quot;Streamflow losses&quot;                = mean(d.river$flow.in),
             &quot;Tributary basin underflow&quot;        = mean(d.trib$flow),
             &quot;Water-table discharge&quot;            = mean(d.rech$flow.out),
             &quot;Streamflow gains&quot;                 = mean(d.river$flow.out),
             &quot;Production well pumping&quot;          = mean(d.well$flow),
             &quot;Stanton Crossing outlet boundary&quot; = mean(d.drain.1$flow),
             &quot;Silver Creek outlet boundary&quot;     = mean(d.drain.2$flow))
budget1 &lt;- setNames(as.integer(abs(budget1)) * 0.296106669, names(budget1))</code></pre>
<p>Next, read the water-budget output for the Scenario 2 simulation, located in the “model” folder.</p>
<pre class="r"><code>dir.run &lt;- &quot;model&quot;
eval(parse(text = unlist(app.d.chunks[paste0(&quot;read_budget_&quot;, 1:2)])))</code></pre>
<p>And save the average volumetric flow rates to an R object named “budget2” using</p>
<pre class="r"><code>budget2 &lt;- c(&quot;Water-table recharge&quot;             = mean(d.rech$flow.in),
             &quot;Streamflow losses&quot;                = mean(d.river$flow.in),
             &quot;Tributary basin underflow&quot;        = mean(d.trib$flow),
             &quot;Water-table discharge&quot;            = mean(d.rech$flow.out),
             &quot;Streamflow gains&quot;                 = mean(d.river$flow.out),
             &quot;Production well pumping&quot;          = mean(d.well$flow),
             &quot;Stanton Crossing outlet boundary&quot; = mean(d.drain.1$flow),
             &quot;Silver Creek outlet boundary&quot;     = mean(d.drain.2$flow))
budget2 &lt;- setNames(as.integer(abs(budget2)) * 0.296106669, names(budget2))</code></pre>
</div>
<div id="compare-water-budgets" class="section level3">
<h3>Compare water budgets</h3>
<p>A comparison between water budgets is made by constructing the following table.</p>
<p><strong>Table:</strong> Water budgets for modified and archived simulation, specified as volumetric flow rates average over 1998–2010. [<strong>Inflow:</strong> water entering the aquifer system. <strong>Outflow:</strong> water leaving the aquifer system. <strong>Component:</strong> a water budget component in the groundwater-flow model. <strong>Archived Rate:</strong> is the mean volumetric flow rate for the archived simulation. <strong>Modified Rate</strong>: is the mean volumetric flow rate for the modified simulation. <strong>Difference:</strong> is the archived rate subtracted from the modified rate. <strong>Abbreviations:</strong> acre-ft/yr, acre-feet per year]</p>
<pre class="r"><code>d &lt;- data.frame(rate1 = budget1, rate2 = budget2)
d$direction &lt;- c(&quot;**Inflow**&quot;, &quot;&quot;, &quot;&quot;, &quot;**Outflow**&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;)
d$component &lt;- names(budget1)
d$diff &lt;- budget2 - budget1
d$pchange &lt;- ((budget2 - budget1) / budget1) * 100
d &lt;- rbind(d[1:3, ], NA, d[4:8, ], NA, NA)
d$component[nrow(d)] &lt;- &quot;**Inflow - Outflow**&quot;
d$rate1[nrow(d)] &lt;- sum(budget1[1:3]) - sum(budget1[5:8])
d$rate2[nrow(d)] &lt;- sum(budget2[1:3]) - sum(budget2[5:8])
rownames(d) &lt;- NULL
d &lt;- d[, c(&quot;direction&quot;, &quot;component&quot;, &quot;rate1&quot;, &quot;rate2&quot;, &quot;diff&quot;, &quot;pchange&quot;)]
colnames(d) &lt;- c(&quot;&quot;, &quot;Component&quot;, &quot;Archived rate&lt;br&gt;(acre-ft/yr)&quot;,
                 &quot;Scenario rate&lt;br&gt;(acre-ft/yr)&quot;, &quot;Difference&lt;br&gt;(arce-ft/yr)&quot;,
                 &quot;Percent&lt;br&gt;change&quot;)
d[, 3] &lt;- formatC(d[, 3], format = &quot;f&quot;, digits = 0, big.mark = &quot;,&quot;)
d[, 4] &lt;- formatC(d[, 4], format = &quot;f&quot;, digits = 0, big.mark = &quot;,&quot;)
d[, 5] &lt;- formatC(d[, 5], format = &quot;f&quot;, digits = 0, big.mark = &quot;,&quot;)
d[, 6] &lt;- formatC(d[, 6], format = &quot;f&quot;, digits = 1, big.mark = &quot;,&quot;)
d[, 1:2][is.na(d[, 1:2])]  &lt;- &quot;&quot;
d[, 3:6][d[, 3:6] == &quot;NA&quot;] &lt;- &quot;&quot;
knitr::kable(d, format = &quot;markdown&quot;, padding = 0, booktabs = TRUE, digits = 0,
             row.names = FALSE, col.names = colnames(d), align = &quot;llrrrr&quot;)</code></pre>
<table style="width:100%;">
<colgroup>
<col width="7%" />
<col width="21%" />
<col width="20%" />
<col width="20%" />
<col width="18%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Component</th>
<th align="right">Archived rate<br>(acre-ft/yr)</th>
<th align="right">Scenario rate<br>(acre-ft/yr)</th>
<th align="right">Difference<br>(arce-ft/yr)</th>
<th align="right">Percent<br>change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Inflow</strong></td>
<td align="left">Water-table recharge</td>
<td align="right">131,738</td>
<td align="right">131,594</td>
<td align="right">-144</td>
<td align="right">-0.1</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Streamflow losses</td>
<td align="right">177,813</td>
<td align="right">177,501</td>
<td align="right">-312</td>
<td align="right">-0.2</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Tributary basin underflow</td>
<td align="right">44,042</td>
<td align="right">44,042</td>
<td align="right">0</td>
<td align="right">0.0</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"><strong>Outflow</strong></td>
<td align="left">Water-table discharge</td>
<td align="right">28,708</td>
<td align="right">28,708</td>
<td align="right">0</td>
<td align="right">0.0</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Streamflow gains</td>
<td align="right">251,967</td>
<td align="right">252,628</td>
<td align="right">661</td>
<td align="right">0.3</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Production well pumping</td>
<td align="right">62,538</td>
<td align="right">61,459</td>
<td align="right">-1,078</td>
<td align="right">-1.7</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">Stanton Crossing outlet boundary</td>
<td align="right">284</td>
<td align="right">284</td>
<td align="right">0</td>
<td align="right">0.0</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Silver Creek outlet boundary</td>
<td align="right">9,492</td>
<td align="right">9,492</td>
<td align="right">-0</td>
<td align="right">-0.0</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"><strong>Inflow - Outflow</strong></td>
<td align="right">29,312</td>
<td align="right">29,274</td>
<td align="right"></td>
<td align="right"></td>
</tr>
</tbody>
</table>
</div>
<div id="read-hydraulic-heads" class="section level3">
<h3>Read hydraulic heads</h3>
<p>Read simulated hydraulic heads for archived simulation, located in “archive” folder, and save results.</p>
<p>Read the simulated hydraulic head (head) output for the archived calibrated model, located in the “archive” folder, and save the results for later use. To do so, run the code chunk named “read_head” in Appendix D using the following commands:</p>
<pre class="r"><code>dir.run &lt;- &quot;archive&quot;
eval(parse(text = app.d.chunks[[&quot;read_head&quot;]]))</code></pre>
<p>And save the simulated heads in model layer 1 on August 16, 2007 to an R object named “head1” using</p>
<pre class="r"><code>head1 &lt;- rs.heads.lay1[[&quot;2007-08-16&quot;]]</code></pre>
<p>Next, read the simulated head output for the Scenario 2 model, located in the “model” folder.</p>
<pre class="r"><code>dir.run &lt;- &quot;model&quot;
eval(parse(text = app.d.chunks[[&quot;read_head&quot;]]))</code></pre>
<pre><code># Warning in writeValues(out, v, tr$row[i]): Reached total allocation of
# 16366Mb: see help(memory.size)

# Warning in writeValues(out, v, tr$row[i]): Reached total allocation of
# 16366Mb: see help(memory.size)</code></pre>
<p>And save the simulated heads in model layer 1 on August 16, 2007 to an R object named “head2” using</p>
<pre class="r"><code>head2 &lt;- rs.heads.lay1[[&quot;2007-08-16&quot;]]</code></pre>
</div>
<div id="compare-head-distributions" class="section level3">
<h3>Compare head distributions</h3>
<p>A comparison between head distributions is made by constructing the following figure.</p>
<p><strong>Figure:</strong> Simulated water table difference, defined as the archived water table subtracted from the modified water table, during August 2007.</p>
<pre class="r"><code>r &lt;- head2 - head1
r[] &lt;- r[] * 3.28084
usr &lt;- c(2472304, 2497015, 1343284, 1358838)
r &lt;- crop(r, extent(usr))
zlim &lt;- range(pretty(range(r[], na.rm = TRUE)))
ratio &lt;- abs(zlim[1]) / diff(zlim)
Pal &lt;- function(...) {
  Pal1 &lt;- colorRampPalette(c(&quot;#F02311&quot;, &quot;#F02311&quot;, &quot;#FFD0D4&quot;))
  Pal2 &lt;- colorRampPalette(c(&quot;#FCFBE3&quot;, &quot;#67A9CF&quot;, &quot;#025D8C&quot;))
  n1 &lt;- round(... * ratio)
  n2 &lt;- ... - n1
  return(c(Pal1(n1), Pal2(n2)))
}
explanation &lt;- &quot;Hydraulic head differnce, in feet&quot;
PlotMap(r, xlim = usr[1:2], ylim = usr[3:4], zlim = zlim, bg.image = hill.shading,
        bg.image.alpha = 0.6, pal = Pal, dms.tick = TRUE, max.dev.dim = c(43, 56),
        rivers = list(x = streams.rivers), lakes = list(x = lakes),
        explanation = explanation, credit = &quot;&quot;, contour.lines = list(col = &quot;#1F1F1F&quot;))
legend(&quot;topright&quot;, &quot;Contour line&quot;, col=&quot;#1F1F1F&quot;, lty = 1, lwd = 0.5,
       inset = 0.02, cex = 0.7, box.lty = 1, box.lwd = 0.5, bg = &quot;#FFFFFFCD&quot;)</code></pre>
<p><img src="figures/map_water_tbl_diff-1.png" width="716" style="display: block; margin: auto;" /></p>
</div>
</div>

<div id="page-footer">
  <p>This information is preliminary and is subject to revision.
    It is being provided to meet the need for timely best science.
    The information is provided on the condition that neither the
    U.S. Geological Survey (USGS) nor the U.S. Government shall be held liable for
    any damages resulting from the authorized or unauthorized use of this information.
    The content is in the public domain because it contains materials that
    originally came from the USGS, an agency of the United States Department of Interior.
    For more information, see the
    <a href="https://www2.usgs.gov/visual-id/credit_usgs.html#copyright/">official USGS copyright policy</a>.
  </p>
</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});


</script>


</body>
</html>
